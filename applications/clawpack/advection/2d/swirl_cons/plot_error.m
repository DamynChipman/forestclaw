function plot_error(ex,n)

close all;

if (nargin == 0)
    ex = 1;
    n = 1;
end

% Using wave-decomposition approach (no limiters)
qerr = cell(7,5);

% u(x) = cos(2*pi*x)
qerr{1,1} = [32   1.5912e-01   4.1814e-01   1.4841e+00
   64   9.9424e-02   3.7146e-01   1.7177e+00
  128   4.6475e-02   2.2194e-01   1.4135e+00
  256   1.2133e-02   6.9347e-02   6.5336e-01
  512   3.5412e-03   1.9011e-02   2.0626e-01
 1024   1.1881e-03   5.3847e-03   5.4493e-02];

qerr{1,2} = [32   4.6568e-01   1.4373e+00   6.9858e+00
  64   2.8923e-01   1.2635e+00   7.2547e+00
 128   1.8978e-01   1.0750e+00   9.8899e+00
 256   1.0903e-01   8.4040e-01   1.1862e+01
 512   5.5548e-02   6.0228e-01   1.2282e+01
1024   2.7773e-02   4.2619e-01   1.2328e+01]; 

qerr{1,3} = [32   2.9178e-01   1.1711e+00   6.0072e+00
   64   1.3997e-01   7.4514e-01   4.3342e+00
  128   6.8514e-02   4.0987e-01   3.9477e+00
  256   2.5097e-02   1.7597e-01   2.4684e+00
  512   3.5412e-03   1.9011e-02   2.0626e-01
 1024   1.8254e-03   1.1264e-02   2.3070e-01];


% u(x) = cos(2*pi*x) + 1

qerr{2,1} =[32   1.8009e-01   4.7518e-01   2.0792e+00
   64   6.3383e-02   2.4100e-01   1.4229e+00
  128   1.9258e-02   7.8394e-02   4.7784e-01
  256   5.1323e-03   2.1607e-02   1.5401e-01
  512   1.5520e-03   6.0791e-03   4.0763e-02
 1024   6.8544e-04   2.3465e-03   1.5291e-02];

qerr{2,2} = [32   1.8524e-01   4.7071e-01   1.7192e+00
   64   9.2308e-02   3.0194e-01   1.4694e+00
  128   3.1187e-02   1.2470e-01   9.0700e-01
  256   9.8048e-03   4.4727e-02   4.0692e-01
  512   2.8553e-03   1.4297e-02   1.6208e-01
 1024   9.5918e-04   4.4519e-03   6.1335e-02];

qerr{2,3} = [32   1.3407e-01   3.3212e-01   1.1358e+00
   64   7.4384e-02   2.4447e-01   1.2958e+00
  128   2.5883e-02   1.0377e-01   8.2012e-01
  256   8.1702e-03   4.0644e-02   3.7039e-01
  512   2.7002e-03   1.4005e-02   1.5318e-01
 1024   9.9136e-04   4.4793e-03   5.9818e-02
];

% u(x) = cos(2*pi*x) + 2
qerr{3,1} = [32   3.9439e-02   5.8435e-02   1.7026e-01   6.3268e-01   1.7393e+00
   64   9.8473e-03   1.5017e-02   4.5871e-02   6.2853e-01   1.6408e+00
  128   2.3975e-03   3.6084e-03   1.0442e-02   6.2706e-01   1.6050e+00
  256   6.1827e-04   9.2513e-04   2.6738e-03   6.2668e-01   1.5980e+00
  512   2.3071e-04   3.1341e-04   8.7267e-04   6.2659e-01   1.5965e+00
 1024   1.8877e-04   2.1254e-04   4.3359e-04   6.2657e-01   1.5961e+00];

qerr{3,2} = [32   3.6187e-02   4.8738e-02   1.2630e-01   6.4039e-01   1.6404e+00
   64   1.2200e-02   1.9247e-02   5.9150e-02   6.2930e-01   1.6287e+00
  128   3.9896e-03   7.2108e-03   2.6202e-02   6.2712e-01   1.6055e+00
  256   1.2112e-03   2.4075e-03   1.0975e-02   6.2669e-01   1.5968e+00
  512   4.4261e-04   7.9112e-04   4.4130e-03   6.2659e-01   1.5962e+00
 1024   2.4636e-04   3.1358e-04   1.6584e-03   6.2657e-01   1.5960e+00];

qerr{3,3} = [32   3.5321e-02   4.7696e-02   1.2340e-01   6.3852e-01   1.6421e+00
   64   1.1929e-02   1.9038e-02   5.8247e-02   6.2885e-01   1.6292e+00
  128   4.0060e-03   7.2646e-03   2.5964e-02   6.2706e-01   1.6059e+00
  256   1.2364e-03   2.4170e-03   1.0919e-02   6.2668e-01   1.5972e+00
  512   4.4207e-04   7.9437e-04   4.3987e-03   6.2659e-01   1.5964e+00
 1024   2.4627e-04   3.1426e-04   1.6546e-03   6.2657e-01   1.5961e+00];

% u(x) = 0.2*sin(2*pi*x).*sin(16*pi*x);

qerr{4,1} = [32   8.6657e-01   1.1572e+00   2.1867e+00  -3.5953e-01   2.3842e+00 
   64   6.4393e-01   1.3197e+00   3.8671e+00  -4.8052e-01   4.3651e+00
  128   4.5013e-01   1.3910e+00   6.5626e+00  -7.1903e-01   8.3629e+00
  256   2.3681e-01   1.1248e+00   8.7730e+00  -3.6552e-02   1.5067e+01
  512   9.8045e-02   5.1671e-01   6.1422e+00   1.7950e-02   2.4706e+01
 1024   4.8410e-02   3.6915e-01   4.2991e+00   1.7936e-02   3.5966e+01];

qerr{4,2} = [32   1.1205e+00   1.3962e+00   3.2763e+00  -1.0952e+00   3.5089e+00
   64   8.4698e-01   1.5558e+00   5.9012e+00  -9.2472e-01   6.4031e+00
  128   5.8595e-01   1.7014e+00   1.0521e+01  -9.2328e-01   1.2321e+01
  256   3.9611e-01   1.6696e+00   1.5567e+01  -9.2155e-01   2.1861e+01
  512   2.6775e-01   1.4609e+00   1.7709e+01  -9.2094e-01   3.6272e+01
 1024   1.6185e-01   1.2428e+00   1.6532e+01  -9.2064e-01   5.4570e+01];

qerr{4,3} = [32   1.0103e+00   1.2556e+00   3.0171e+00  -9.1147e-01   3.2497e+00
   64   6.1378e-01   1.4920e+00   6.0794e+00  -1.0220e-01   6.5686e+00
  128   3.9726e-01   1.6103e+00   1.0404e+01  -4.0730e-03   1.2204e+01
  256   2.5334e-01   1.5112e+00   1.5048e+01   1.5042e-02   2.1342e+01
  512   1.5760e-01   1.1407e+00   1.6018e+01   1.7336e-02   3.4581e+01
 1024   7.4513e-02   7.2387e-01   1.1242e+01   1.7796e-02   4.9281e+01];


% u(x) = 0.1*sin(2*pi*x).*sin(16*pi*x);
qerr{5,1} = [64   2.3588e-01   5.0014e-01   1.7770e+00   7.1382e-02   3.5692e+00
  128   9.0054e-02   2.1206e-01   9.7620e-01   8.3378e-02   5.8794e+00
  256   4.8950e-02   1.6750e-01   9.2215e-01   8.1476e-02   8.4231e+00
  512   2.0538e-02   9.1359e-02   7.7049e-01   8.1118e-02   1.0489e+01
 1024   5.8732e-03   2.9355e-02   3.8313e-01   8.1031e-02   1.1668e+01
];

qerr{5,2} = [64   5.2366e-01   8.7828e-01   3.4521e+00  -7.2596e-01   5.2373e+00  
  128   3.3777e-01   7.4497e-01   3.7213e+00  -7.2211e-01   8.6023e+00
  256   1.9971e-01   6.1797e-01   3.7083e+00  -7.2033e-01   1.2613e+01
  512   1.1608e-01   4.9040e-01   4.9519e+00  -7.1910e-01   1.6200e+01
 1024   6.2785e-02   3.7297e-01   6.1081e+00  -7.1841e-01   1.8147e+01];

qerr{5,3} = [64   3.2642e-01   7.4866e-01   3.3553e+00  -1.9770e-02   5.1405e+00 
  128   1.7286e-01   5.4437e-01   3.3010e+00   6.6695e-02   8.1820e+00
  256   7.5510e-02   3.2238e-01   2.3586e+00   7.8817e-02   1.1263e+01
  512   3.1304e-02   1.5908e-01   2.0880e+00   8.0585e-02   1.3336e+01
 1024   1.0970e-02   6.5940e-02   1.4112e+00   8.0912e-02   1.3450e+01];

% u(x) = tanh((x-0.5)/0.01)
qerr{6,1} = [   32   4.2532e-02   8.6819e-02   2.7792e-01  -8.0918e-02   1.0000e+00
   64   2.0874e-02   4.9269e-02   2.0834e-01  -6.9339e-02   1.0000e+00
  128   9.1846e-03   2.5071e-02   1.2553e-01  -3.1492e-02   1.0000e+00
  256   3.2721e-03   1.0524e-02   6.3070e-02   6.8406e-12   1.0000e+00
  512   9.7418e-04   3.3978e-03   2.3224e-02   1.2951e-11   1.0000e+00
 1024   2.5266e-04   8.8805e-04   6.3623e-03   1.3697e-11   1.0000e+00];

qerr{6,2} = [   32   5.0311e-02   7.9050e-02   2.2869e-01  -5.3621e-02   1.0000e+00
   64   4.3591e-02   5.8997e-02   1.2740e-01  -1.0149e-01   1.0000e+00   
  128   3.4280e-02   4.8244e-02   1.6131e-01  -1.6131e-01   1.0000e+00
  256   2.2748e-02   3.5535e-02   2.2155e-01  -2.2155e-01   1.0000e+00
  512   1.2870e-02   2.3639e-02   2.5233e-01  -2.5233e-01   1.0000e+00
 1024   6.7241e-03   1.5470e-02   2.6646e-01  -2.6646e-01   1.0000e+00];

qerr{6,3} = [   32   3.5075e-02   7.8916e-02   2.7532e-01  -2.3724e-02   1.0000e+00
   64   1.8340e-02   4.6161e-02   2.1077e-01  -2.9930e-02   1.0000e+00 
  128   1.0801e-02   2.6815e-02   1.3006e-01  -2.8200e-02   1.0000e+00
  256   5.3615e-03   1.2992e-02   5.9389e-02  -1.7319e-02   1.0000e+00
  512   2.4159e-03   5.8764e-03   2.4968e-02  -8.6086e-03   1.0000e+00
 1024   1.1125e-03   2.7621e-03   1.1408e-02  -4.1557e-03   1.0000e+00];

qerr{6,4} = [   32   6.8161e-02   1.5296e-01   6.0469e-01  -2.7187e-01   1.0000e+00
   64   3.3949e-02   8.5119e-02   3.7456e-01  -2.2742e-01   1.0000e+00
  128   1.6201e-02   4.1051e-02   1.7764e-01  -1.3872e-01   1.0000e+00
  256   7.1963e-03   1.7376e-02   7.8282e-02  -3.7960e-02   1.0000e+00
  512   2.9574e-03   7.1511e-03   2.7692e-02  -1.3439e-02   1.0000e+00
 1024   1.2571e-03   3.1260e-03   1.2836e-02  -6.1793e-03   1.0000e+00];

% u(x) = -tanh((x-0.5)/0.1)
qerr{7,1} = [   32   6.8220e-02   2.0568e-01   7.8131e-01   1.0005e+00   6.4950e+00
   64   2.6516e-02   1.0842e-01   5.7044e-01   1.0005e+00   8.6233e+00
  128   1.9785e-02   1.0044e-01   6.1693e-01   1.0005e+00   1.0389e+01
  256   6.1397e-03   3.8040e-02   3.7708e-01   1.0005e+00   1.1476e+01
  512   1.8022e-03   1.0875e-02   1.3820e-01   1.0005e+00   1.1959e+01
 1024   6.3045e-04   3.0375e-03   3.9603e-02   1.0005e+00   1.2121e+01];

qerr{7,2} = [   32   6.7161e-02   2.5823e-01   1.0322e+00   1.0005e+00   6.7459e+00
   64   2.4742e-02   1.0449e-01   5.5100e-01   1.0005e+00   9.3944e+00
  128   2.5639e-02   1.3199e-01   8.3336e-01   1.0005e+00   1.1840e+01
  256   2.3454e-02   1.5924e-01   1.5093e+00   1.0005e+00   1.3362e+01
  512   1.4004e-02   1.2688e-01   1.8041e+00   1.0005e+00   1.3901e+01
 1024   7.1874e-03   8.9704e-02   1.8482e+00   1.0005e+00   1.4009e+01];

qerr{7,3} = [  32   9.9205e-02   4.6539e-01   2.5771e+00   1.0005e+00   8.2908e+00
   64   9.8526e-02   5.3836e-01   3.4631e+00   1.0005e+00   1.2307e+01
  128   7.7608e-02   5.7235e-01   4.9926e+00   1.0005e+00   1.5999e+01
  256   4.8333e-02   4.9673e-01   6.2018e+00   1.0005e+00   1.8055e+01
  512   2.5346e-02   3.7269e-01   6.5073e+00   1.0005e+00   1.8605e+01
 1024   1.2941e-02   2.6967e-01   6.5378e+00   1.0005e+00   1.8699e+01];

qerr{7,4}=  [   32   2.8884e-01   1.0306e+00   4.7102e+00   1.0005e+00   1.0424e+01
   64   1.8489e-01   9.0046e-01   5.3152e+00   1.0005e+00   1.3493e+01
  128   1.0683e-01   7.2497e-01   6.3813e+00   1.0005e+00   1.5941e+01
  256   5.7972e-02   5.4146e-01   6.4848e+00   1.0005e+00   1.7431e+01
  512   3.0433e-02   3.9261e-01   6.3833e+00   1.0005e+00   1.8114e+01
 1024   1.5666e-02   2.8063e-01   6.3320e+00   1.0005e+00   1.8366e+01];

qerr{7,5} = [   32   6.7866e-02   2.5970e-01   1.0378e+00   1.0005e+00   6.7515e+00
   64   2.6681e-02   1.1165e-01   5.8203e-01   1.0005e+00   9.4255e+00
  128   2.8971e-02   1.5029e-01   9.3995e-01   1.0005e+00   1.1946e+01
  256   2.7240e-02   1.8722e-01   1.7514e+00   1.0005e+00   1.3604e+01
  512   1.6960e-02   1.5618e-01   2.1821e+00   1.0005e+00   1.4279e+01
 1024   8.9592e-03   1.1390e-01   2.3010e+00   1.0005e+00   1.4462e+01];



e1 = 1;
e2 = 3;
switch ex
    case 1
        % u(x) = cos(2*pi*x)
        nvec = 32*2.^[0:5]';
        idx = 4:6;
    case 2
        % u(x) = cos(2*pi*x) + 1
        nvec = 32*2.^[0:5]';
        idx = 4:6;
    case 3
        % u(x) = cos(2*pi*x) + 2
        nvec = 32*2.^[0:5]';
        idx = 2:4;
    case 4
        % u(x) = 0.2*sin(2*pi*x).*sin(16*pi*x);
        nvec = 32*2.^[1:5]';
        idx = 1:4;
    case 5
        % u(x) = 0.1*sin(2*pi*x).*sin(16*pi*x);
        nvec = 32*2.^[1:5]';
        idx = 3:5;
    case 6
        % u(x) = tanh((x-0.5)/0.01)
        nvec = 32*2.^[0:5]';
        idx = 4:6;
        e1 = 1;
        e2 = 4;
    case 7
        % u(x) = tanh((x-0.5)/0.01)
        nvec = 32*2.^[0:5]';
        idx = 4:6;
        e1 = 1;
        e2 = 5;
end
    
l = {'w-d (no-lim)','w-d (lim)','f-wave (lim)','ustar (no-lim)','ustar (lim)'};

s = {'r.','b.','g.','k.','c.','y.'};    
ph = [];
leg_str = {};
for i = e1:e2,
    qe = qerr{ex,i};
    c = polyfit(log(nvec(idx)),log(qe(idx,n+1)),1);
    loglog(nvec,exp(polyval(c,log(nvec))),'k','linewidth',2);
    hold on;
    ph(i) = loglog(nvec,qe(:,n+1),s{i},'markersize',30);
    leg_str{i} = sprintf('%s (slope = %.2f)',l{i},-c(1));
    hold on;
end

p1 = log(nvec(1))/log(2);
p2 = log(nvec(end))/log(2);

set(gca,'xlim',[2^(p1-0.5),2^(p2+0.5)]);
grid on;

tstr = sprintf('Errors in conservative scheme (ex=%d)',ex);
title(tstr,'fontsize',18);
set(gca,'fontsize',16);
xlabel('N','fontsize',16);
ylabel('Error','fontsize',16);

lh = legend(ph,leg_str,'location',...
    'southwest');
set(lh,'fontsize',16);



shg

end
    

