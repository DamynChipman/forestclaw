function plot_error(ex,n,add_limiter)

close all;

if (nargin == 0)
    ex = 1;
    n = 1;
    add_limiter = 0;
end

% Using wave-decomposition approach (no limiters)
qerr = cell(7,5);

% 1-2 : ustar (no lim, with lim)
% 3-4 : wave-decomp (no-lim, with-lim)
% 5-6 : edge (no-lim, with-lim)
% 7-8 : fwave (no-lim, with-lim)


% -------------------------------------------
% Ex. 1 : u(x) = cos(2*pi*x) + 2
% -------------------------------------------
qerr{1,1} = [  32   4.0960e-02   6.0462e-02   1.7538e-01   6.3310e-01   1.7444e+00
  64   1.0102e-02   1.5315e-02   4.6855e-02   6.2861e-01   1.6418e+00
 128   2.4494e-03   3.6656e-03   1.0624e-02   6.2708e-01   1.6051e+00
 256   6.2900e-04   9.3798e-04   2.7135e-03   6.2668e-01   1.5981e+00
 512   2.3192e-04   3.1571e-04   8.8220e-04   6.2659e-01   1.5965e+00
1024   1.8877e-04   2.1274e-04   4.3572e-04   6.2657e-01   1.5961e+00];

qerr{1,2} = [  32   4.0960e-02   6.0462e-02   1.7538e-01   6.3310e-01   1.7444e+00
  64   1.2068e-02   1.9047e-02   5.8421e-02   6.2941e-01   1.6291e+00
 128   3.9570e-03   7.1601e-03   2.5955e-02   6.2715e-01   1.6056e+00
 256   1.2054e-03   2.3971e-03   1.0906e-02   6.2669e-01   1.5968e+00
 512   4.4165e-04   7.8894e-04   4.3948e-03   6.2659e-01   1.5962e+00
1024   2.4621e-04   3.1320e-04   1.6537e-03   6.2657e-01   1.5960e+00];

qerr{1,3} = [32   3.9439e-02   5.8435e-02   1.7026e-01   6.3268e-01   1.7393e+00
   64   9.8473e-03   1.5017e-02   4.5871e-02   6.2853e-01   1.6408e+00
  128   2.3975e-03   3.6084e-03   1.0442e-02   6.2706e-01   1.6050e+00
  256   6.1827e-04   9.2513e-04   2.6738e-03   6.2668e-01   1.5980e+00
  512   2.3071e-04   3.1341e-04   8.7267e-04   6.2659e-01   1.5965e+00
 1024   1.8877e-04   2.1254e-04   4.3359e-04   6.2657e-01   1.5961e+00];

qerr{1,4} = [32   3.6187e-02   4.8738e-02   1.2630e-01   6.4039e-01   1.6404e+00
   64   1.2200e-02   1.9247e-02   5.9150e-02   6.2930e-01   1.6287e+00
  128   3.9896e-03   7.2108e-03   2.6202e-02   6.2712e-01   1.6055e+00
  256   1.2112e-03   2.4075e-03   1.0975e-02   6.2669e-01   1.5968e+00
  512   4.4261e-04   7.9112e-04   4.4130e-03   6.2659e-01   1.5962e+00
 1024   2.4636e-04   3.1358e-04   1.6584e-03   6.2657e-01   1.5960e+00];

qerr{1,5} = [     32   5.5381e-02   7.5739e-02   1.9969e-01   6.4267e-01   1.7619e+00
   64   1.7326e-02   2.3328e-02   5.6995e-02   6.3298e-01   1.6504e+00
  128   6.6938e-03   8.2207e-03   1.6901e-02   6.2925e-01   1.6100e+00
  256   2.9043e-03   3.4613e-03   6.9878e-03   6.2774e-01   1.6006e+00
  512   1.3683e-03   1.6060e-03   3.1055e-03   6.2711e-01   1.5978e+00
 1024   6.7571e-04   7.8274e-04   1.4227e-03   6.2682e-01   1.5968e+00];

   
qerr{1,6} = [  32   5.0733e-02   6.4124e-02   1.3692e-01   6.5720e-01   1.6103e+00
  64   1.7595e-02   2.2712e-02   5.2805e-02   6.3567e-01   1.6190e+00
 128   6.5031e-03   8.0883e-03   1.9375e-02   6.2972e-01   1.6052e+00
 256   2.8770e-03   3.4336e-03   7.4884e-03   6.2785e-01   1.5990e+00
 512   1.3851e-03   1.6113e-03   3.0977e-03   6.2713e-01   1.5974e+00
1024   7.0163e-04   8.0357e-04   1.4182e-03   6.2683e-01   1.5967e+00];

qerr{1,7} = [  32   3.9439e-02   5.8435e-02   1.7026e-01   6.3268e-01   1.7393e+00
  64   9.8473e-03   1.5017e-02   4.5871e-02   6.2853e-01   1.6408e+00
 128   2.3975e-03   3.6084e-03   1.0442e-02   6.2706e-01   1.6050e+00
 256   6.1827e-04   9.2513e-04   2.6738e-03   6.2668e-01   1.5980e+00 
 512   2.3071e-04   3.1341e-04   8.7267e-04   6.2659e-01   1.5965e+00
1024   1.8877e-04   2.1254e-04   4.3359e-04   6.2657e-01   1.5961e+00];

qerr{1,8} = [32   3.5321e-02   4.7696e-02   1.2340e-01   6.3852e-01   1.6421e+00
   64   1.1929e-02   1.9038e-02   5.8247e-02   6.2885e-01   1.6292e+00
  128   4.0060e-03   7.2646e-03   2.5964e-02   6.2706e-01   1.6059e+00
  256   1.2364e-03   2.4170e-03   1.0919e-02   6.2668e-01   1.5972e+00
  512   4.4207e-04   7.9437e-04   4.3987e-03   6.2659e-01   1.5964e+00
 1024   2.4627e-04   3.1426e-04   1.6546e-03   6.2657e-01   1.5961e+00];

% Ex. 1 : u(x) = cos(2*pi*x)
qerr{2,1} = [  32   6.7231e-01   2.1753e+00   9.8740e+00  -1.4899e-01   1.9985e+01
  64   4.2176e-01   1.8964e+00   1.1646e+01  -1.4156e-01   2.6510e+01
 128   2.3267e-01   1.4850e+00   1.3107e+01  -1.3808e-01   3.1420e+01
 256   1.2394e-01   1.0934e+00   1.2919e+01  -1.3639e-01   3.4094e+01
 512   6.4359e-02   7.8743e-01   1.2678e+01  -1.3557e-01   3.5171e+01
1024   3.2981e-02   5.6096e-01   1.2592e+01  -1.3515e-01   3.5531e+01];

qerr{2,2} = [  32   1.2899e-01   3.9627e-01   1.5619e+00   5.0475e-02   1.1673e+01
  64   2.6999e-02   6.0069e-02   1.8833e-01   4.3401e-02   1.7672e+01
 128   7.0976e-02   3.4246e-01   1.9701e+00   3.6119e-02   2.3300e+01
 256   6.3207e-02   4.0037e-01   3.7342e+00   3.3320e-02   2.6417e+01
 512   3.5594e-02   3.0607e-01   4.3169e+00   3.2426e-02   2.7341e+01
1024   1.8231e-02   2.1949e-01   4.4470e+00   3.2180e-02   2.7558e+01];

qerr{2,3} = [   32   1.5915e-01   4.1821e-01   1.4840e+00   4.3678e-02   1.1595e+01   
   64   9.9351e-02   3.7161e-01   1.7185e+00   4.3325e-02   1.6302e+01   
  128   4.6332e-02   2.2201e-01   1.4143e+00   4.3241e-02   2.0000e+01
  256   1.2001e-02   6.9423e-02   6.5455e-01   4.3221e-02   2.2029e+01
  512   3.4869e-03   1.9084e-02   2.0756e-01   4.3216e-02   2.2817e+01
 1024   1.1811e-03   5.4569e-03   5.5830e-02   4.3214e-02   2.3055e+01];

qerr{2,4} = [  32   4.6576e-01   1.4374e+00   6.9858e+00  -8.3445e-01   1.7097e+01
  64   2.8930e-01   1.2635e+00   7.2542e+00  -8.3342e-01   2.4753e+01
 128   1.8992e-01   1.0750e+00   9.8891e+00  -8.3283e-01   3.1303e+01
 256   1.0915e-01   8.4038e-01   1.1861e+01  -8.3251e-01   3.4544e+01
 512   5.5626e-02   6.0227e-01   1.2280e+01  -8.3234e-01   3.5304e+01
1024   2.7818e-02   4.2618e-01   1.2326e+01  -8.3226e-01   3.5437e+01];

qerr{2,5} = [  32   1.8531e-01   5.2647e-01   2.0393e+00   3.2505e-02   1.2150e+01
  64   9.2813e-02   3.2715e-01   1.5563e+00   3.7873e-02   1.6533e+01
 128   5.2166e-02   2.2783e-01   1.5451e+00   4.0546e-02   1.9869e+01
 256   2.1038e-02   9.4322e-02   9.3114e-01   4.1881e-02   2.1752e+01
 512   9.6470e-03   4.1255e-02   4.4185e-01   4.2547e-02   2.2582e+01
1024   4.8342e-03   1.9397e-02   2.0292e-01   4.2881e-02   2.2908e+01];  
    
qerr{2,6} = [  32   1.3067e-01   3.1368e-01   1.0620e+00   3.3582e-02   1.0730e+01
  64   1.3186e-01   4.0615e-01   1.8758e+00   3.8145e-02   1.5623e+01
 128   5.7416e-02   2.3518e-01   1.7030e+00   4.0615e-02   1.9711e+01
 256   2.5162e-02   1.0020e-01   9.3729e-01   4.1898e-02   2.1746e+01
 512   1.0985e-02   4.3208e-02   4.4186e-01   4.2552e-02   2.2582e+01
1024   5.1581e-03   1.9882e-02   2.0292e-01   4.2882e-02   2.2908e+01];
    
qerr{2,7} = [   32   1.5915e-01   4.1821e-01   1.4840e+00   4.3678e-02   1.1595e+01
   64   9.9351e-02   3.7161e-01   1.7185e+00   4.3325e-02   1.6302e+01
  128   4.6332e-02   2.2201e-01   1.4143e+00   4.3241e-02   2.0000e+01
  256   1.2001e-02   6.9423e-02   6.5455e-01   4.3221e-02   2.2029e+01
  512   3.4869e-03   1.9084e-02   2.0756e-01   4.3216e-02   2.2817e+01
 1024   1.1811e-03   5.4569e-03   5.5830e-02   4.3214e-02   2.3055e+01];

qerr{2,8} = [   32   2.9196e-01   1.1711e+00   6.0071e+00   4.0724e-02   1.6118e+01
   64   1.4012e-01   7.4514e-01   4.3337e+00   4.2753e-02   2.1832e+01
  128   6.8673e-02   4.0986e-01   3.9468e+00   4.3115e-02   2.5361e+01 
  256   2.5187e-02   1.7594e-01   2.4672e+00   4.3191e-02   2.5150e+01
  512   6.5822e-03   4.7283e-02   8.5971e-01   4.3208e-02   2.3884e+01        
 1024   1.8414e-03   1.1223e-02   2.2937e-01   4.3213e-02   2.3340e+01];




% ---------------------------------
% 2. u(x) = tanh((x-0.65)/0.025) + tanh((0.35-x)/0.04);
% ---------------------------------

qerr{3,1} = [  32   3.7155e-02   8.7323e-02   4.0844e-01   3.3545e-01   2.6545e+00  
  64   1.4365e-02   4.1614e-02   2.4764e-01   3.3618e-01   2.7540e+00
 128   5.0356e-03   1.6003e-02   1.0818e-01   3.3858e-01   2.7989e+00
 256   1.3060e-03   4.7331e-03   3.6576e-02   3.3896e-01   2.7624e+00
 512   3.4063e-04   1.1994e-03   1.0118e-02   3.3905e-01   2.7422e+00
1024   9.7958e-05   2.8372e-04   2.4956e-03   3.3907e-01   2.7391e+00];

qerr{3,2} = [  32   2.7627e-02   6.5350e-02   2.8404e-01   3.4403e-01   2.4273e+00
  64   1.0060e-02   2.6516e-02   1.2135e-01   3.4054e-01   2.6276e+00
 128   3.2247e-03   9.5675e-03   5.9938e-02   3.3955e-01   2.6864e+00
 256   9.5283e-04   3.1395e-03   2.1851e-02   3.3920e-01   2.7233e+00
 512   2.9299e-04   1.0402e-03   8.9296e-03   3.3911e-01   2.7332e+00
1024   1.0618e-04   3.3502e-04   3.1480e-03   3.3908e-01   2.7370e+00];

qerr{3,3} = [ 32   3.6279e-02   8.3085e-02   3.9463e-01   3.2783e-01   2.6238e+00
 64   1.4054e-02   3.9828e-02   2.4214e-01   3.3589e-01   2.7404e+00
128   4.9927e-03   1.5507e-02   1.0647e-01   3.3851e-01   2.7932e+00
256   1.3101e-03   4.6311e-03   3.6209e-02   3.3894e-01   2.7612e+00
512   3.4321e-04   1.1794e-03   1.0059e-02   3.3905e-01   2.7420e+00
1024   9.8865e-05   2.8020e-04   2.4725e-03   3.3907e-01   2.7391e+00];

qerr{3,4} = [  32   2.8129e-02   6.7941e-02   2.9385e-01   3.4298e-01   2.4175e+00
  64   1.0291e-02   2.7684e-02   1.2553e-01   3.4035e-01   2.6222e+00  
 128   3.3426e-03   1.0056e-02   6.2639e-02   3.3950e-01   2.6851e+00
 256   9.8525e-04   3.2742e-03   2.2819e-02   3.3918e-01   2.7227e+00
 512   3.0032e-04   1.0652e-03   8.9877e-03   3.3911e-01   2.7330e+00
1024   1.0838e-04   3.4030e-04   3.1431e-03   3.3908e-01   2.7369e+00];

qerr{3,5} = [32   5.8049e-02   1.2103e-01   5.4797e-01   3.2587e-01   2.6595e+00
  64   2.4524e-02   6.0828e-02   3.5226e-01   3.3575e-01   2.7862e+00
 128   1.0291e-02   2.6496e-02   1.7552e-01   3.3836e-01   2.8030e+00 
 256   4.3067e-03   1.0690e-02   7.5021e-02   3.3881e-01   2.7595e+00
 512   1.9656e-03   4.5653e-03   3.0402e-02   3.3897e-01   2.7398e+00
1024   9.5965e-04   2.0999e-03   1.2824e-02   3.3903e-01   2.7380e+00];

qerr{3,6} = [  32   5.5626e-02   1.1482e-01   5.3846e-01   3.4727e-01   2.3963e+00
  64   2.4576e-02   5.3435e-02   2.8621e-01   3.4149e-01   2.5887e+00 
 128   9.9447e-03   2.2852e-02   1.4528e-01   3.3958e-01   2.6843e+00
 256   4.2188e-03   9.4404e-03   6.0646e-02   3.3914e-01   2.7243e+00
 512   1.9902e-03   4.2089e-03   2.4065e-02   3.3905e-01   2.7338e+00
1024   9.6639e-04   2.0014e-03   9.9807e-03   3.3905e-01   2.7366e+00];

qerr{3,7} = [  32   3.6279e-02   8.3085e-02   3.9463e-01   3.2783e-01   2.6238e+00
  64   1.4054e-02   3.9828e-02   2.4214e-01   3.3589e-01   2.7404e+00
 128   4.9927e-03   1.5507e-02   1.0647e-01   3.3851e-01   2.7932e+00
 256   1.3101e-03   4.6311e-03   3.6209e-02   3.3894e-01   2.7612e+00
 512   3.4321e-04   1.1794e-03   1.0059e-02   3.3905e-01   2.7420e+00  
1024   9.8865e-05   2.8020e-04   2.4725e-03   3.3907e-01   2.7391e+00];

qerr{3,8} = [32   2.6747e-02   6.7698e-02   2.8699e-01   1.5386e-01   2.7556e+00
64   1.0959e-02   3.5489e-02   1.8552e-01   1.5588e-01   3.3541e+00
 128   4.2347e-03   1.5610e-02   1.1091e-01   1.5511e-01   3.7042e+00
256   1.2616e-03   5.0829e-03   4.6533e-02   1.5525e-01   3.7955e+00
512   4.0269e-04   1.8253e-03   2.1537e-02   1.5541e-01   3.8137e+00
1024   1.5054e-04   6.5108e-04   8.3283e-03   1.5544e-01   3.8238e+00];

qerr{3,8} = [  32   2.6799e-02   6.3055e-02   2.7744e-01   3.4511e-01   2.4339e+00
  64   9.5592e-03   2.4930e-02   1.1756e-01   3.4105e-01   2.6357e+00
 128   3.0017e-03   8.6867e-03   5.5210e-02   3.3970e-01   2.6890e+00
 256   8.8669e-04   2.7985e-03   1.9616e-02   3.3923e-01   2.7246e+00
 512   2.8791e-04   9.5612e-04   8.2811e-03   3.3912e-01   2.7336e+00
1024   1.0501e-04   3.1888e-04   3.0223e-03   3.3909e-01   2.7371e+00];

% 4. u(x) = 0.5*(tanh((x-0.65)/0.025) + tanh((0.35-x)/0.04)) + 0.5;

qerr{4,1} = [ 32   2.2658e-01   6.9191e-01   2.9502e+00  -2.1092e-01   4.8899e+00
 64   2.0448e-01   9.8606e-01   5.8763e+00  -2.3071e-02   7.8905e+00
128   3.2455e-02   1.4332e-01   1.3412e+00  -9.7053e-02   6.5769e+00
256   1.0143e-02   5.2058e-02   5.6274e-01  -3.4802e-02   6.3537e+00
512   2.4259e-02   3.0852e-01   4.9162e+00  -1.6154e-01   1.1289e+01
1024   1.8183e-02   3.3996e-01   8.0757e+00  -5.2756e-01   1.4535e+01];

qerr{4,2} = [ 32   8.7914e-02   2.6729e-01   1.3264e+00   1.4977e-02   3.2661e+00
 64   1.0075e-01   4.2965e-01   2.4927e+00  -9.7832e-03   4.9674e+00
128   1.5252e-02   6.1703e-02   4.7364e-01   7.0529e-02   6.3138e+00
256   1.6637e-02   1.2518e-01   1.6754e+00   4.2812e-02   8.1846e+00
512   1.1284e-02   1.1809e-01   2.4514e+00   3.4919e-03   8.8241e+00
1024   8.6620e-03   1.2778e-01   3.7248e+00  -1.2786e-02   1.0184e+01];

qerr{4,3} = [32   5.0227e-02   1.3775e-01   6.9702e-01   4.4385e-02   3.4080e+00
64   4.7570e-02   2.2730e-01   1.6481e+00   5.2208e-02   4.6699e+00
128   1.1739e-02   6.9618e-02   6.6547e-01   4.9655e-02   5.4423e+00
256   3.8198e-03   2.7996e-02   3.8889e-01   4.9681e-02   6.1204e+00
512   1.1908e-03   8.3437e-03   1.2190e-01   4.9776e-02   6.3677e+00
1024   3.6140e-04   2.4706e-03   3.6388e-02   4.9782e-02   6.4831e+00];

qerr{4,4} = [  32   1.1418e-01   2.6893e-01   9.4666e-01  -5.0040e-01   4.5675e+00
  64   4.0111e-02   1.3442e-01   9.5011e-01  -1.1930e-01   6.3412e+00
 128   4.6841e-02   2.0841e-01   1.7108e+00  -4.2011e-01   7.8185e+00
 256   2.5936e-02   1.7431e-01   2.3162e+00  -1.1016e-01   8.8255e+00
 512   1.6042e-02   1.4486e-01   2.8177e+00  -4.1379e-01   9.3073e+00
1024   7.3005e-03   9.6679e-02   2.7460e+00  -1.0943e-01   9.2655e+00];

qerr{4,5} = [  32   5.8460e-02   1.4739e-01   6.3535e-01   2.6607e-03   3.2250e+00
  64   5.3923e-02   2.4129e-01   1.8019e+00   2.3991e-02   4.5161e+00
 128   1.7219e-02   7.8195e-02   8.0192e-01   3.7398e-02   5.3058e+00
 256   7.8775e-03   3.6923e-02   5.2372e-01   4.3225e-02   5.9856e+00
 512   3.5857e-03   1.6051e-02   2.2862e-01   4.6418e-02   6.2610e+00
1024   1.7717e-03   7.4584e-03   1.0618e-01   4.8068e-02   6.4133e+00];

qerr{4,6} = [  32   6.0334e-02   1.4606e-01   5.2644e-01   6.8305e-02   3.1364e+00
  64   5.1963e-02   2.4329e-01   1.8669e+00   3.9713e-02   4.4511e+00
 128   1.9034e-02   8.3932e-02   8.5551e-01   4.1636e-02   5.2522e+00
 256   8.6113e-03   3.9708e-02   5.2872e-01   4.4041e-02   5.9806e+00
 512   4.0296e-03   1.7074e-02   2.2883e-01   4.6678e-02   6.2608e+00
1024   1.9062e-03   7.7638e-03   1.0618e-01   4.8118e-02   6.4133e+00];

qerr{4,7} = [  32   5.0227e-02   1.3775e-01   6.9702e-01   4.4385e-02   3.4080e+00
  64   4.7570e-02   2.2730e-01   1.6481e+00   5.2208e-02   4.6699e+00
 128   1.1739e-02   6.9618e-02   6.6547e-01   4.9655e-02   5.4423e+00
 256   3.8198e-03   2.7996e-02   3.8889e-01   4.9681e-02   6.1204e+00
 512   1.1908e-03   8.3437e-03   1.2190e-01   4.9776e-02   6.3677e+00
1024   3.6140e-04   2.4706e-03   3.6388e-02   4.9782e-02   6.4831e+00];


qerr{4,8} = [  32   5.9094e-02   1.5840e-01   8.0462e-01  -6.5111e-02   4.4440e+00
  64   1.2117e-02   3.9385e-02   2.3141e-01   6.3532e-02   6.0866e+00
 128   1.3769e-02   8.6682e-02   8.2753e-01   4.8242e-02   6.9353e+00
 256   6.8379e-03   5.7872e-02   8.4450e-01   4.9089e-02   7.3538e+00
 512   1.9308e-03   2.1186e-02   4.5388e-01   4.9857e-02   6.9435e+00
1024   5.1561e-04   5.4380e-03   1.5251e-01   4.9716e-02   6.6720e+00];


s = {'rv','r.','bs','b.','m^','m.','gp','g.'};
ms = [10,30,10,30,10,30,10,30];
e = [1 3 5 7] + add_limiter;
nvec = 32*2.^[0:5]';

switch ex
    case 1
        % u(x) = cos(2*pi*x)
        idx = 4:6;
    case 2
        % u(x) = cos(2*pi*x) + 1
        idx = 4:6;
    case 3
        % u(x) = cos(2*pi*x) + 2
        idx = 4:6;
    case 4
        idx = 4:6;
end
    
l = {'ustar  (no-lim)','ustar (lim)', ...
    'w-d (no-lim)','w-d (lim)', ...
    'edge (no-lim)','edge (lim)',...
    'fwave  (no-lim)','fwave (lim)'};

ph = [];
leg_str = {};
for i = e,
    qe = qerr{ex,i};
    if (isempty(qe))
        continue
    end
    c = polyfit(log(nvec(idx)),log(qe(idx,n+1)),1);
    loglog(nvec,exp(polyval(c,log(nvec))),'k','linewidth',2);
    hold on;
    ph = horzcat(ph,loglog(nvec,qe(:,n+1),s{i},'markersize',ms(i)));
    leg_str = horzcat(leg_str,sprintf('%s (slope = %.2f)',l{i},-c(1)));    
    hold on;
end

p1 = log(nvec(1))/log(2);
p2 = log(nvec(end))/log(2);

set(gca,'xlim',[2^(p1-0.5),2^(p2+0.5)]);
grid on;

tstr = sprintf('Errors in conservative scheme (ex=%d)',ex);
title(tstr,'fontsize',18);
set(gca,'fontsize',16);
xlabel('N','fontsize',16);
ylabel('Error','fontsize',16);

lh = legend(ph,leg_str,'location',...
    'southwest');
set(lh,'fontsize',16);



shg

end
    

